<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MatQUIZ - Výsledky kvízu</title>
    <link href='https://fonts.googleapis.com/css?family=Raleway' rel='stylesheet'>
        <style>

       .vyhodnotenie{
          overflow-y: scroll;
          position: fixed;
          top: 150px;
          left: 20%;
          width: 42%;
          height: 75%;
          padding : 10px, 10px;
          font-family: Raleway;
       }
       .statistika{
          overflow-y: scroll;
          position:fixed;
          top: 120px;
          right: 0%;
          width: 550px;
          height: 83%;
          padding: 10px, 10px;
          font-family: Raleway;
       }



    </style>

</head>
<body>


<script src="https://www.gstatic.com/charts/loader.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>

<script type="text/javascript">

var kv_id, kv_info, ot_odp_id, moje_odp, cas, text, pokus, pokus_id;
var statistika = {}
var oznacene;
$(document).ready(function(){

    kviz_info();
    vypis_vysledky();
    drawChart();

});

function kviz_info(){
    kviz_info = $.ajax({
        type:"GET",
        url: "/kviz_req3",
        async: false,
        dataType: 'json',
        data:{
                 kviz_id: {{kviz_id}}
        },
        success: function( data ){
            //$('#test1').text(JSON.stringify(data))
        }
    }).responseJSON
    podnadpis_str = (kviz_info['nazov']+'   '+kviz_info['predmet']+'    '+kviz_info['typ']);
    $('#podnadpis').text(kviz_info['nazov']+'   '+kviz_info['predmet']+'    '+kviz_info['typ']);

}

function get_vysledky(){

    var vysledky = $.ajax({
        type:"GET",
        url: "/kviz_req13",
        async: false,
        dataType: 'json',
        data:{
                 kviz_id: {{kviz_id}},
                 pokus_id: {{pokus_id}},
        }
    }).responseJSON

    console.log("vysledky: ", JSON.stringify(vysledky));

    return vysledky;

//    vysledky['pokus'] = [pokus.pokus_datum, pokus.pokus_zaciatok, pokus.pokus_koniec,
//                         pokus.pokus_uhadol, pokus.pokus_neuhadol, pokus.pokus_neodpovedal,
//                         pokus.pokus_body]
//        vysledky[i] = [otazka_def, mojaOdp.odpoved_def, mojaOdp.odpoved_spravna,
//                       mojaOdp.odpoved_body]

}

function vypis_vysledky(){

    var oznacene = get_vysledky();
    poc_otazok = Object.keys(oznacene).length - 1;

    var pokus_info = oznacene['pokus'];
//    delete oznacene['pokus'];

     statistika={'nezodpovedane':pokus_info[5],
                    'spravne':pokus_info[3],
                    'nespravne':pokus_info[4],
                     'spolu_otazok': (pokus_info[5]+pokus_info[4]+pokus_info[3]),
                     'body_zisk': pokus_info[6],
                     'body_max': pokus_info[7]};

    var ele = document.getElementById("vysl1");
    for(i=0; i<poc_otazok; i++){
        znenie_ot = '<b>'+(i+1)+'/'+poc_otazok+'</b>   '+ oznacene[i][0] +'<br>'; //znenie otazky aj s pocitadlom
        console.log("odpoved: "+oznacene[i][2]+" --- "+oznacene[i][1])
        if(oznacene[i][2] == true){
                znenie_odp = '<p style="color:green;">'+oznacene[i][1]+'<br>SPRAVNA ODPOVED :)</p>';
        } else if(oznacene[i][2] == -1){
            znenie_odp = '<p style="color:blue;">Otazka nezodpovedana</p>';
        }else if(oznacene[i][2] == false){
                znenie_odp = '<p style="color:red;">'+oznacene[i][1]+'<br>NESPRAVNA ODPOVED :(</p>';
        }

        ele.innerHTML += (znenie_ot+znenie_odp);
    }
    console.log("statistika "+JSON.stringify(statistika));

}
//VYKRESLI VYSLEDKY
        google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawChart);

function drawChart() {
        // ---- vykreslenie statistiky otazok -----
        var data_ot = google.visualization.arrayToDataTable([
          ['Odpovede k otázkam', 'Počet', { role: "style" }],
          ['Správne',     statistika['spravne'], "#C9E465"],
          ['Nesprávne',      statistika['nespravne'], "#FFBE58"],
          ['Neozodpovedané',  statistika['nezodpovedane'], "#E5E5E5"],
        ]);

        var options_ot = {
          title: 'Výsledky kvízu',
          legend: { position: "none" },
        };

        var chart_ot = new google.visualization.ColumnChart(document.getElementById('otazky'));

        chart_ot.draw(data_ot, options_ot);

        // ---- vykreslenie bodov -----
        var data_b = google.visualization.arrayToDataTable([
          ['Bodovanie', 'Počet'],
          ['Získané body',     statistika['body_zisk']],
          ['Nezískané body',      statistika['body_max']-statistika['body_zisk']],
        ]);

        var options_b = {
          title: 'Získané body',
          colors: ['#C9E465','#E5E5E5'],
        };

        var chart_b = new google.visualization.PieChart(document.getElementById('body'));

        chart_b.draw(data_b, options_b);




}

</script>


{% include 'MenuBar.html' %}
<div class="topheader">
        <style scoped>
        {% include 'styles/TopHeader_style.css' %}
    </style>
    <p1>VÝSLEDKY KVÍZU</p1>
    <p2 id="podnadpis"></p2>
</div>
<div class="vyhodnotenie" id="vysl1"></div>

<div class="statistika">
    <div id="otazky" style="width: 500px; height: 300px;"></div>
    <div id="body" style="width: 500px; height: 300px;"></div>
</div>
<!--<div class="actionbar" id="actionbar1">-->
<!--    <style scoped>-->
<!--        {% include 'styles/ActionBar_style.css' %}-->
<!--    </style>-->
<!--</div>-->


</body>
</html>